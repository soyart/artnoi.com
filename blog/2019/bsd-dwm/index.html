<!doctype html><html lang=en><head><title>Artnoi.com - FreeBSD 12.0: Installing dwm on ThinkPad X230</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content="artnoi,Prem Phansuriyanon"><meta name=author content="@artnoi"><meta charset=UTF-8><link href=/style.css rel=stylesheet><script src=/script.js></script></head><body><ul class=navbar id=navbar><li><a href=/><img src=/toplogo.png alt=Artnoi.com class=logo>artnoi</a></li><li class=f-right><a href=https://notes.artnoi.com/#/all-pages>logseq</a></li><li class=f-right><a href=/cheat/>cheat</a></li><li class=f-right><a href=/blog/>blog</a></li></ul><p>Aug 6, <a href=/blog/2019/>2019</a></p><h1 id=freebsd-12-0-installing-dwm-on-thinkpad-x230>FreeBSD 12.0: Installing dwm on ThinkPad X230</h1><h2 id=introduction>Introduction</h2><p>In this tutorial I&rsquo;ll guide you on how to prepare FreeBSD installation for <code>dwm</code> on ThinkPad X230. This tutorial will also include how to optimize your system for GUI environment.</p><h3 id=about-dwm>About dwm</h3><p><code>dwm</code> is a suckless window manager. Being a <a href=https://dwm.suckless.org>suckless utility</a>, it does not have or load configuration file, i.e. the configuration is done by patching the source code, which also means that if you want to reconfigure dwm you WILL have to recompile it. I recommend using FreeBSD ports tree as source for dwm because it&rsquo;ll help us install dwm correctly on a FreeBSD system.</p><h3 id=hardware-related>Hardware-related:</h3><h3 id=dbus>dbus</h3><p>Before we proceed make sure that you&rsquo;ve installed and enabled <code>dbus</code> which is required to run our GUI environment:</p><pre><code class=language-shell>pkg install dbus;
sysrc dbus_enable=&quot;YES&quot;;
</code></pre><p>Or you may manually enable it in <code>/etc/rc.conf</code> by adding <code>dbus_enable="YES"</code> instead of issuing <code>sysrc</code> command</p><h3 id=intel-hd-4000-graphics-driver>Intel HD 4000 Graphics driver</h3><p>Now we&rsquo;ll have to install <code>kms</code> driver for our video card. X230 has i5-3240M on it which has Intel HD 4000 integrated graphics so <code>drm_legacy_kmod</code> should work:</p><pre><code class=language-shell>pkg install drm_legacy_kmod;
</code></pre><p>And enable it by adding the following line also in <code>/etc/rc.conf</code></p><pre><code class=language-shell>kld_list=&quot;/boot/modules/i915kms&quot;
</code></pre><p>You also need to add <code>username</code> to <code>video</code> group by issuing the following command</p><pre><code class=language-shell>pw group video -m username;
</code></pre><h3 id=moused>moused</h3><p>For the middle-button scroll to work on ThinkPad and with proper cursor accelaration, you may have to add the following to <code>/etc/rc.conf</code></p><pre><code class=language-shell>moused_enable=&quot;YES&quot;
moused_flags=&quot;-A 2.0,2.0 -a 1.2 -V&quot;
</code></pre><h3 id=sound>Sound</h3><p>Add the following entry in <code>/boot/loader.conf</code></p><pre><code class=language-shell>snd_hda_load=&quot;YES&quot;
</code></pre><p>I also personally add this line to <code>/etc/rc.conf</code></p><pre><code class=language-shell>snddetect_enable=&quot;YES&quot;
mixer_enable=&quot;YES&quot;
</code></pre><p>Now reboot FreeBSD for our changes to take effect. I usually do <code>sudo reboot</code></p><h2 id=installing-prerequisite-depedencies>Installing prerequisite depedencies</h2><h3 id=xorg-minimal-and-other-depedencies><code>xorg-minimal</code> and other depedencies</h3><p>For a window manager to work, we need a display server. I choose xorg-minimal because it has less disk footprint than the full xorg install. We also need some X11 fonts (In this case, <code>Dejavu</code>), <code>xrdb</code> to load external config files, X11 font library <code>libXft</code>, and finally <code>libXinerama</code> for multi-display support. I also want <code>compton</code> for display compositing.</p><pre><code class=language-shell>pkg install xorg-minimal xrdb libXft compton dejavu;
</code></pre><p>Building dwm</p><p>My workflow for patching and building <code>dwm</code> is quite easy, I first extract dwm source from <code>/usr/ports/x11-wm/dwm</code> and then patch the source in <code>work</code> directory. Building must be done in <code>/usr/ports/x11-wm/dwm</code> or dwm will fail to build and install properly because FreeBSD supplies the OS-specific Makefile in the ports.</p><h3 id=extracting-dwm>Extracting dwm</h3><pre><code class=language-shell>cd /usr/ports/x11-wm/dwm;
make extract;
cd work;
</code></pre><p>This should extract dwm source into <code>work/dwm-x.y</code> directory where x.y is dwm version. Take note of dwm version, because it&rsquo;s important to download the correct version of patches.</p><h3 id=patching-and-configuring-dwm>Patching and configuring dwm</h3><p>Now Prepare your patches, find the appropriate version (i.e. the one matching dwm version) and download patches to a convenient location, e.g. <code>$HOME/dwm.patches/</code>:</p><pre><code class=language-shell>mkdir ~/dwm.patches;
wget ~/dwm.patches/ https://dwm.suckless.org/patches/link/to/dwm-patch.diff;
</code></pre><p>Patch the source code in <code>work</code> directory, I&rsquo;m using <code>git apply</code> here:</p><pre><code class=language-shell>git apply ~/dwm.patches/dwm-patch.diff;
</code></pre><p>If no errors were encountered, you should now be ready to build <code>dwm</code>. You must configure dwm before it is built. Now, copy the default config file <code>config.def.h</code> to <code>config.h</code> and edit the copied <code>config.h</code> file with your configuration. We will point to this <code>config.h</code> file later during <code>make install</code> so that the compiler applies our configuration and patches.</p><pre><code class=language-shell>cd  work/dwm-6.2;
cp config.def.h config.h;
vim work/config.h;
</code></pre><p>After you are done with editing and patching, it&rsquo;s build time! Go <em>back to the ports directory of dwm</em> and build it! <strong>Don&rsquo;t forget to supply <code>DWM_CONF</code> flag to point to your patched and customized config.h file other wise it&rsquo;ll fail</strong>. The path can be absolute or relative to the working directory. FreeBSD should present you with its own menu dialog for system-supplied patches (e.g. install <code>sterm</code> and <code>dmenu</code>, etc.) and you can check the boxes according to your needs.</p><pre><code class=language-shell>cd  /usr/ports/x11-wm/dwm;
make DWM_CONF=work/dwm6.2/config.h install clean;
</code></pre><p>If it succeeds, you should now add <code>.xinitrc</code> file to your <code>$HOME</code> directory to tell X to start dwm. My <code>.xinitrc</code> looks like this:</p><pre><code class=language-shell>xrdb -merge $HOME/.Xresources &amp;
compton --config $HOME/.config/compton/compton.conf &amp;
exec dwm;
</code></pre><p>Note that lines after <code>exec dwm</code> will not be executed and hence why I put it at the bottom. After <code>.xinitrc</code> is created, start X Server by issuing</p><pre><code class=language-shell>startx;
</code></pre><p>This should source <code>$HOME/.Xresources</code> file, start <code>compton</code>, and start <code>dwm</code>.</p><hr><p><a href=#top>Back to top</a></p><hr><footer><p>Copyright (c) 2019 Prem Phansuriyanon</p><p>Verbatim copying and redistribution of this entire page are permitted provided this notice is preserved</p></footer></body></html>
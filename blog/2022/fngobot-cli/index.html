<!DOCTYPE html><html lang=en> <head><title>Artnoi.com</title><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=keywords content="artnoi, Prem Phansuriyanon"><meta name=author content=@artnoi><meta charset=UTF-8><link href=/style.css rel=stylesheet></head> <body> <ul class=navbar> <li><a href=/ ><img src=/toplogo.png alt=Artnoi.com class=logo>artnoi</a></li> <li class=f-right><a href=/cheat/ >cheat</a></li> <li class=f-right><a href=/blog/ >blog</a></li> <li class=f-right><a href=/about/ >about</a></li> </ul> <p>Jan 25, 2022</p> <h1 id=%F0%9F%94%A5%20FnGoBot%20now%20has%20a%20CLI!>üî• FnGoBot now has a CLI!</h1> <h2 id=Why%20am%20I%20so%20delightful?>Why am I so delightful?</h2> <p>When I first wrote <a href=https://github.com/soyart/fngobot>FnGoBot</a>, which is my second Go program, I made a lot of mistakes that made it very difficult to change anything in the code. Everything was highly coupled, everywhere and out of place.</p> <p>But after <a href=/blog/2021/dev/ >I got a new job</a>, I have been refactoring the code to the point that I can now easily add a new quote source in &#189; hour, or even add new interface to the bot. And I did just that.</p> <p>Now that I also write tests, adding new feature or refactoring also becomes much easier.</p> <h2 id=%F0%9F%93%9D%20What%20I%20had%20to%20do>üìù What I had to do</h2> <h3 id=Categorization>Categorization</h3> <p>So first I had to identified which part of the bot is a lib, and which part a main. Then I categorized code into roughly 4 packages:</p> <ol> <li><p>Package <code>cmd</code> is where the <code>main</code> programs live.</p></li> <li><p>Package <code>bot</code> deals with bot logic, such as handling alerts, getting quotes based on source, etc.</p></li> <li><p>Package <code>parse</code> defines a parsing function. Because both the Telegram bot and CLI versions use this package, their commands are 100% compatible.</p></li> <li><p>Package <code>fetch</code> deals with getting quotes from remote APIs.</p></li> <li><p>Package <code>enums</code> for enums. lol.</p></li> </ol> <h3 id=Writing%20CLI%20handlers>Writing CLI handlers</h3> <p>FnGoBot interacts with users via <em>handlers</em>. And before CLI, FnGoBot had only 1 type of handlers: Telegram bot handlers.</p> <p>The Telegram bot handler is an interface, but the implentation is a struct with all the fields required by a Telgram chatbot embedded. So a CLI handler should me much more simpler and minimalistic than the Telegram bot handler.</p> <p>All I had to do was to create a new package <code>bot&#47;handler_cli</code> and write code!</p> <h2 id=Other%20recently%20FnGoBot%20features>Other recently FnGoBot features</h2> <h3 id=%3Ccode%3Efetch.Quoter%3C/code%3E%20interface><code>fetch.Quoter</code> interface</h3> <p>The <code>fetch.Quoter</code> interface abstracts how quotes can be passed around to functions. It defines 3 methods: <code>Last()</code>, <code>Bid()</code>, <code>Ask()</code>.</p> <p>To add a new quote source, I&#8217;ll just have to parse its API data into a struct that implement this interface, and the entire FnGoBot can now use quotes from that new sources.</p> <h3 id=Handlers%20management>Handlers management</h3> <ol> <li><p>Users can now see all of the handlers with <code>&#47;handlers</code></p></li> <li><p>Users can also stop a running handler with <code>&#47;stop &#60;UUID&#62;</code></p></li> <li><p>Handlers are stored per-sender in a map, so now users can only see and stop their own handlers</p></li> </ol> <hr> <p><a href=#top>Back to top</a></p> <hr> <footer> <p>Copyright (c) 2019 - 2023 Prem Phansuriyanon</p> <p>Verbatim copying and redistribution of this entire page are permitted provided this notice is preserved</p> </footer> </body> </html> 
<!doctype html><html lang=en><title>Artnoi.com</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content="artnoi,Prem Phansuriyanon"><meta name=author content="@artnoi"><meta charset=UTF-8><link href=/style.css rel=stylesheet><ul class=navbar><li><a href=/><img src=/toplogo.png alt=Artnoi.com class=logo>artnoi</a><li class=f-right><a href=/cheat/>cheat</a><li class=f-right><a href=https://notes.artnoi.com/#/all-pages>notes</a><li class=f-right><a href=/blog/>blog</a></ul><p>Nov 2, 2022<h1 id=introducing-superwatcher>Introducing superwatcher</h1><p>If you work for a Web3 company, then you almost certainly, at some points,
have to work with <a href=https://goethereumbook.org/events/>event logs</a>.<h2 id=event-logs>Event logs</h2><p>Event logs are, essentially, data emitted by smart contracts after certain events
(e.g. function calls) happened.<blockquote><p>Emitting an event log is usually not free of cost. On Ethereum and its forks, emitting
an event log costs <em>gas</em>. As a result, smart contract programmers have to decide
when and when not to emit event log.</blockquote><h3 id=why-not-just-filter-logs>Why not just filter logs?</h3><p>Most of the Web3 backend code revolves around log and transaction subscription,
which is fine and easy<p><em>if</em> the blockchain today is what it has always <em>trying</em> to be - a reliable single
source of truth. This however is not the case. As of this writing, most Ethereum-like
blockchains experience what we hatefully call <em>chain reorg</em>.<p>Chain reorgs happen when the blockchain nodes decided that some of the produced
blocks contained frauded transactions. To discard the produced blocks, the produced
(reorged) blocks will be invalidated with a new block replacing the reorged blocks.<p>These new blocks and their hashes are used instead to link the current chain to
its future blocks.<p>So with this in mind, you should begin to see why handling a chain reorg is
cubersome and tiring. Any recent data you got from the chain has the probability
to be invalidated later by the chain itself.<h2 id=superwatcher>superwatcher</h2><p>superwatcher is a <em>Go library</em> for implementing Ethereum event log-filtering services.
It provides a clean and sane interface for interacting with event logs on the
Ethereum blockchain.<p>Baked to its core was chain reorg support. Unlike <code>go-ethereum</code> code, superwatcher
takes chain reorgs very seriously, and it expects that its users know about what
a chain reorg is and what to do when one happens.<p>The exposed interface that the users will implement only roughly defines 3 methods,
first one for handling filtered event logs (obviously), the second was what to
do if we know that some logs were reorged, and the third one for handling
superwatcher error.<h2 id=status>Status</h2><p>As of 2022, superwatcher has been in beta stage. It passed tests, and it can handle
chain reorgs, but its interfaces and features are not yet stable. We hope to be able
to ship it before the end of 2023.<hr><p><a href=#top>Back to top</a><hr><footer><p>Copyright (c) 2019 - 2023 Prem Phansuriyanon<p>Verbatim copying and redistribution of this entire page are permitted provided this notice is preserved</footer>